import{_ as k,r as h,o as f,c as g,a as e,b as n,F as V,e as E,f as L,t as d,w as T,d as _,g as v,v as x,n as p}from"./index-6e10f009.js";const{VITE_URL:r,VITE_PATH:c}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"test8283",BASE_URL:"/vue-training/week6/dist/",MODE:"production",DEV:!1,PROD:!0},U={data(){return{isLoading:!1,cart:{},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getCart(){this.isLoading=!0,this.$http.get(`${r}/api/${c}/cart`).then(t=>{this.cart=t.data.data,this.isLoading=!1}).catch(t=>console.log(t))},updateToCart(t){this.isLoading=!0;const s={product_id:t.product_id,qty:t.qty};this.$http.put(`${r}/api/${c}/cart/${t.id}`,{data:s}).then(()=>{this.isLoading=!1,this.getCart()}).catch(b=>alert(b.data.message))},deleteCarts(){this.$http.delete(`${r}/api/${c}/carts`).then(()=>{this.getCart()}).catch(t=>alert(t.data.message))},deleteCart(t){this.loading=t,this.$http.delete(`${r}/api/${c}/cart/${t}`).then(()=>{this.getCart(),this.loading=""}).catch(s=>{this.loading="",alert(s.data.message)})},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼"},onSubmit(){this.$http.post(`${r}/api/${c}/order`,{data:this.form}).then(t=>{this.$swal({title:`${t.data.message}`,text:`訂單編號 ${t.data.orderId}`}),this.form.message="",this.$refs.form.resetForm(),this.getCart()}).catch(t=>alert(t.data.message))}},mounted(){this.getCart()}},w={class:"text-end"},q={class:"table align-middle"},F=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),$=["onClick"],N=e("i",{class:"fas fa-spinner fa-pulse"},null,-1),S=e("div",{class:"text-success"},"已套用優惠券",-1),D={class:"input-group input-group-sm"},I={class:"input-group mb-3"},P=["onUpdate:modelValue","onChange"],B={class:"input-group-text",id:"basic-addon2"},M={class:"text-end"},R=e("small",{class:"text-success"},"折扣價：",-1),A=e("td",{colspan:"3",class:"text-end"},"總計",-1),H={class:"text-end"},O=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),j={class:"text-end text-success"},z={class:"my-5 row justify-content-center"},G={class:"mb-3"},J=e("label",{for:"email",class:"form-label"},"Email",-1),K={class:"mb-3"},Q=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),W={class:"mb-3"},X=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Y={class:"mb-3"},Z=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ee={class:"mb-3"},te=e("label",{for:"message",class:"form-label"},"留言",-1),se=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function le(t,s,b,ae,a,i){const C=h("VLoading"),m=h("VField"),u=h("ErrorMessage"),y=h("VForm");return f(),g(V,null,[e("div",w,[n(C,{active:a.isLoading,"can-cancel":!1,color:"#007bff","is-full-page":!0},null,8,["active"]),e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...l)=>i.deleteCarts&&i.deleteCarts(...l))}," 清空購物車 ")]),e("table",q,[F,e("tbody",null,[a.cart.carts?(f(!0),g(V,{key:0},E(a.cart.carts,l=>(f(),g("tr",{key:l.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>i.deleteCart(l.id)},[N,_(" x ")],8,$)]),e("td",null,[_(d(l.product.title)+" ",1),S]),e("td",null,[e("div",D,[e("div",I,[v(e("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":o=>l.qty=o,onChange:o=>i.updateToCart(l)},null,40,P),[[x,l.qty]]),e("span",B,d(l.product.unit),1)])])]),e("td",M,[_(d(l.total)+" ",1),R,_(" "+d(l.final_total),1)])]))),128)):L("",!0)]),e("tfoot",null,[e("tr",null,[A,e("td",H,d(a.cart.total),1)]),e("tr",null,[O,e("td",j,d(a.cart.final_total),1)])])]),e("div",z,[n(y,{ref:"form",class:"col-md-6",onSubmit:i.onSubmit},{default:T(({errors:l})=>[e("div",G,[J,n(m,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":l.email}]),rules:"email|required",placeholder:"請輸入 Email",modelValue:a.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=o=>a.form.user.email=o)},null,8,["class","modelValue"]),n(u,{name:"email",class:"invalid-feedback"})]),e("div",K,[Q,n(m,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=o=>a.form.user.name=o)},null,8,["class","modelValue"]),n(u,{name:"姓名",class:"invalid-feedback"})]),e("div",W,[X,n(m,{id:"tel",name:"電話",type:"text",class:p(["form-control",{"is-invalid":l.電話}]),rules:i.isPhone,placeholder:"請輸入電話",modelValue:a.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=o=>a.form.user.tel=o)},null,8,["class","rules","modelValue"]),n(u,{name:"電話",class:"invalid-feedback"})]),e("div",Y,[Z,n(m,{id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:a.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=o=>a.form.user.address=o)},null,8,["class","modelValue"]),n(u,{name:"地址",class:"invalid-feedback"})]),e("div",ee,[te,v(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=o=>a.form.message=o)},null,512),[[x,a.form.message]])]),se]),_:1},8,["onSubmit"])])],64)}const ne=k(U,[["render",le]]);export{ne as default};
